@model cocycle_admin.Models.createrequest

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}
@section Style{

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="~/Content/Assets/plugins/select2-bootstrap4-theme/select2-bootstrap4.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Content/Assets/TavoCalendar-master/dist/tavo-calendar.css" />
    <link rel='stylesheet' href='~/Content/Assets/TavoCalendar-master/uicons-solid-rounded.css'>
}
<div class="content-header">
    <div class="container">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark">Arranged Ride</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active">Arranged Ride</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<section class="content">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title">Create Request</h3>
                    </div>
                    <div class="card-body">


                        @using (Html.BeginForm())
                        {
                           
                            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css" />
                            <input type="hidden" name="OfferingDates" id="OfferingDates" value="" required="required" />
                            @Html.AntiForgeryToken()
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                      
                                        <div class="col-md-12">
                                            @Html.LabelFor(model => model.UserId, htmlAttributes: new { @class = "control-label " })
                                            @Html.DropDownList("UserId", new SelectList(ViewBag.Users, "Id", "UserName"), " Select User", new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.UserId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="form-group  " style="width: 100%; margin:0 auto">
                                        <div class="col-md-12">
                                            <label>Select Availibility</label>
                                            @Html.ValidationMessageFor(model => model.OfferingDates, "", new { @class = "text-danger" })
                                            <div id="my-calendar"></div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            @Html.LabelFor(model => model.RequestRemark, htmlAttributes: new { @class = "control-label " })
                                            @Html.EditorFor(model => model.RequestRemark, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.RequestRemark, "", new { @class = "text-danger" })
                                        </div>
                                    </div>


                                </div>
                                <div class="col-md-6">
                                 
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <label class="control-label">Post Code</label>
                                            @Html.DropDownList("PostCodeId", new SelectList(ViewBag.postCodes, "Id", "PostCodeName"), " Select PostCode", new { @class = "form-control select2bs4" })
                                            @Html.ValidationMessageFor(model => model.PostCodeId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            @Html.LabelFor(model => model.StateId, htmlAttributes: new { @class = "control-label " })
                                            @Html.DropDownList("StateId", new SelectList(ViewBag.States, "StateId", "StateName"), " Select State", new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.StateId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="form-group">
                                       
                                        <div class="col-md-12">
                                           <label class = "control-label"> City</label>
                                            @Html.DropDownList("AreaId", new SelectList(ViewBag.areas, "Id", "AreaName"), " Select City", new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.AreaId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            @Html.LabelFor(model => model.StartPoint, htmlAttributes: new { @class = "control-label " })
                                            @Html.EditorFor(model => model.StartPoint, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.StartPoint, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-offset-2 col-md-10">
                                            <input type="submit" value="Create" class="btn btn-primary" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        <div>
                            @Html.ActionLink("Back to List", "Index", "", new { @class = "btn btn-default" })
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</section>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!--  jquery script  -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!--  validation script  -->
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.19.0/jquery.validate.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>

    <script src="~/Content/Assets/TavoCalendar-master/dist/tavo-calendar.js"></script>



    @Scripts.Render("~/bundles/jqueryval")

    <script>
       
        var selectedDates;

        const myCalendar = new TavoCalendar('#my-calendar', {
            date: new Date(),
            multi_select: true,
            highlight_sunday: false,
            highlight: [/*2021-06-25*/],
            format: "MM-DD-YYYY"
        })

        document.getElementById('my-calendar').addEventListener('calendar-select', (ev) => {
            selectedDates = myCalendar.getSelected();
            $('#OfferingDates').val(selectedDates);
            //  myCalendar.blacklist = selectedDates;
        });

    //$(document).ready(function () {
    //    $("#frmroutes").validate({
    //        rules: {
    //            ignore: [],
    //            //txtfathername: { required: true },
    //            //radiotype: { required: true },
    //            //  aadharfile: { required: true }
    //        },
    //        onkeyup: false,
    //        onblur: true
    //    });

    //});

    //var form = $("#frmroutes");
    //form.validate();

          $('#PostCodeId').change(function () {
        var postcodeid = $('#PostCodeId').val();
        if (postcodeid == "") {
            $('#StateId').val("");
            $('#AreaId').val("");
        } else {
        $.ajax({
                type: 'POST',
                url:'@Url.Content("~/PostCodes/GetstateandArea/")',
                  data: "{postcode:'" + postcodeid + "'}",
                dataType: 'json',
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    $('#StateId').val(data.StateId);
                   // getarea(data.StateId, data.AreaId);
                    $('#AreaId').val(data.AreaId);
                },

            });
        }

    });
        $("#PostCodeId").select2({
            theme: "classic",
            placeholder: "Start Post Code",
            allowClear: true,
            ajax: {
                url: "../../PostCodes/Getpostcode",
                type: 'get',
                dataType: 'json',
                //delay: 500,
                data: function (params) {
                    return {
                        searchTerm: params.term,
                        areaid:$('#AreaId').val(),
                    };
                },
                processResults: function (res) {
                    return {
                        results: res
                    }
                },
                cache: true,
            }
        });

    $("#UserId").select2({
        theme: "classic",
        placeholder: "Select Novice User",
    });


 var ddlarea = document.getElementById("AreaId");

    $('#StateId').change(function () {
        var id = $('#StateId option:selected').val();
          //  alert(id);
            if (id > 0) {

            $.ajax({
                type: 'POST',
                url:'@Url.Content("~/Areas/GetByState/")',
                //url: '/State/GetByState/' + id + '',
                data: "{Stateid:'" + id + "'}",
                dataType: 'json',
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    ddlarea.innerHTML = "";
                    data.forEach((item) => {
                        ddlarea.options[ddlarea.options.length] = new Option(item.AreaName, item.Id);
                    });
                },
            });
        }
            else {
                ddlarea.innerHTML = "";
                ddlarea.options[ddlarea.options.length] = new Option("Select Area", "");
            }

        });
    </script>
}
